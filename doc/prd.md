# EmAilX 产品需求文档 (PRD)
## Product Requirements Document

---

## 📋 **产品概述**

**产品名称**: EmAilX - 智能邮件管理平台  
**产品版本**: v1.0  
**文档版本**: 1.0  
**更新日期**: 2025年7月19日

### 产品定位
EmAilX 是一个基于 Next.js 构建的智能邮件管理 SaaS 平台，集成 Azure OpenAI 技术，为用户提供全功能邮件客户端、AI 智能回复生成和团队协作功能。

---

## 🎯 **核心功能模块**

### 1. 邮件服务模块

#### 1.1 邮件连接和认证
**功能描述**: 支持用户连接任意 IMAP/SMTP 邮件服务器
- **IMAP 连接**: 支持 SSL/TLS 加密连接
- **SMTP 发送**: 支持邮件发送功能
- **多服务器支持**: 支持 Gmail、Outlook、Yahoo 及自定义邮件服务器
- **安全认证**: 用户凭据本地验证，不存储密码

**技术实现**:
- 使用 `node-imap` 库处理 IMAP 连接
- 使用 `nodemailer` 处理 SMTP 发送
- 按需连接模式，每次操作独立建立连接

#### 1.2 邮件同步和管理
**功能描述**: 实时邮件同步和全方位邮件操作
- **邮件同步**: 支持增量同步和全量同步
- **文件夹管理**: 支持收件箱、已发送、垃圾箱等文件夹
- **邮件操作**: 
  - 标记已读/未读
  - 加星标/取消星标
  - 删除邮件
  - 获取邮件正文内容

**技术实现**:
- 邮件解析使用 `mailparser/simpleParser`
- 支持 HTML 和纯文本邮件格式
- 邮件缓存使用 IndexedDB 本地存储

#### 1.3 邮件撰写和发送
**功能描述**: 完整的邮件撰写功能
- **撰写界面**: 支持 To、CC、BCC、主题、正文
- **HTML 支持**: 支持富文本和 HTML 格式邮件
- **回复功能**: 支持回复和全部回复
- **发送验证**: SMTP 认证和发送状态反馈

### 2. AI 智能助手模块

#### 2.1 智能回复生成
**功能描述**: 基于 Azure OpenAI 的智能邮件回复生成
- **自动回复**: 基于原邮件内容生成智能回复
- **多语言支持**: 自动检测邮件语言（英文/德文）
- **上下文理解**: 分析邮件主题、发件人、内容生成相关回复

**技术实现**:
- 集成 Azure OpenAI GPT-4.1 模型
- 使用结构化 Prompt 模板
- Zod 数据验证确保响应格式

#### 2.2 回复风格定制
**功能描述**: 提供多种回复风格选择
- **语言选项**: 英文、德文回复
- **语调选项**: 
  - 正式 (Formal): 专业正式语调
  - 随意 (Casual): 友好非正式语调
  - 简洁 (Concise): 简短直接
  - 详细 (Detailed): 详细全面

#### 2.3 对话式 AI 助手
**功能描述**: 聊天式 AI 交互界面
- **对话历史**: 记录用户与 AI 的完整对话
- **迭代优化**: 基于用户反馈优化回复内容
- **实时交互**: 实时响应用户需求和修改建议

### 3. 用户界面模块

#### 3.1 邮件列表界面
**功能描述**: Outlook 风格的邮件管理界面
- **三栏布局**: 文件夹列表 + 邮件列表 + 邮件内容
- **邮件预览**: 显示发件人、主题、时间、预览内容
- **状态标识**: 已读/未读、星标、附件图标
- **无限滚动**: 支持大量邮件的性能优化加载

#### 3.2 邮件详情查看
**功能描述**: 完整的邮件内容展示
- **邮件头信息**: 发件人、收件人、抄送、时间等
- **内容渲染**: 支持 HTML 和纯文本邮件显示
- **附件处理**: 显示附件列表和基本信息
- **操作按钮**: 回复、转发、删除、标记等快捷操作

#### 3.3 AI 交互界面
**功能描述**: 聊天式 AI 助手界面
- **消息气泡**: 区分用户消息和 AI 响应
- **修改建议**: 可直接应用 AI 建议的回复修改
- **草稿同步**: AI 生成内容实时同步到邮件草稿

### 4. 认证和会话模块

#### 4.1 用户认证
**功能描述**: 安全的用户身份验证
- **JWT 认证**: 基于 JSON Web Token 的无状态认证
- **Cookie 存储**: HTTP-only Cookie 安全存储 token
- **自动刷新**: 用户活跃时自动延续会话

**技术实现**:
- 使用 `jose` 库处理 JWT 签名和验证
- 密码哈希使用 `bcryptjs`
- 30分钟活跃超时，1小时会话过期

#### 4.2 会话管理
**功能描述**: 用户会话状态管理
- **活跃检测**: 监控用户活跃状态
- **会话延续**: 自动更新活跃用户的会话时间
- **安全登出**: 清理会话数据和 Cookie

### 5. 团队协作模块

#### 5.1 团队管理
**功能描述**: 多用户团队协作功能
- **角色权限**: Owner、Member 等角色划分
- **成员邀请**: 邮箱邀请新成员加入团队
- **权限控制**: 基于角色的功能访问控制

**数据模型**:
- **Teams**: 团队基本信息和订阅状态
- **TeamMembers**: 团队成员关系和角色
- **Invitations**: 团队邀请管理

#### 5.2 活动日志
**功能描述**: 团队活动跟踪
- **操作记录**: 记录团队内重要操作
- **IP 追踪**: 记录操作来源 IP
- **时间戳**: 精确的操作时间记录

### 6. 支付和订阅模块

#### 6.1 Stripe 集成
**功能描述**: 完整的 SaaS 订阅支付功能
- **订阅管理**: 支持多种订阅计划
- **Checkout 流程**: 安全的支付页面
- **客户门户**: 用户自助管理订阅
- **Webhook 处理**: 实时同步支付状态

#### 6.2 订阅状态管理
**功能描述**: 用户订阅状态跟踪
- **状态同步**: 实时同步 Stripe 订阅状态
- **试用期管理**: 14天免费试用
- **计划升级**: 支持订阅计划变更

### 7. 仪表板模块

#### 7.1 主仪表板
**功能描述**: 用户主控制台
- **数据概览**: 邮件统计、未读数量、发送统计
- **快捷操作**: 快速访问常用功能
- **活动时间线**: 最近邮件活动展示

#### 7.2 设置管理
**功能描述**: 用户和团队设置
- **用户设置**: 个人信息、密码修改
- **团队设置**: 团队信息、成员管理
- **订阅管理**: 计划详情、付费管理
- **安全设置**: 安全相关配置

---

## 🛠️ **技术架构**

### 技术栈
- **前端框架**: Next.js 15 + React 19 + TypeScript
- **UI 组件**: shadcn/ui + Tailwind CSS
- **状态管理**: SWR + React Hooks
- **数据库**: PostgreSQL + Drizzle ORM
- **AI 服务**: Azure OpenAI (GPT-4.1)
- **邮件处理**: node-imap + nodemailer + mailparser
- **认证**: JWT (jose) + bcryptjs
- **支付**: Stripe API
- **部署**: Vercel + Turbopack

### 架构特点
- **全栈应用**: Next.js API Routes 处理后端逻辑
- **无状态设计**: JWT 认证，每次邮件操作独立连接
- **模块化设计**: 清晰的功能模块划分
- **类型安全**: 全 TypeScript 开发，Zod 数据验证

---

## 📱 **用户流程**

### 首次使用流程
1. **用户注册** → 创建账户和团队
2. **邮件登录** → 输入邮件服务器凭据
3. **连接验证** → 测试 IMAP/SMTP 连接
4. **邮件同步** → 同步邮件列表
5. **功能探索** → 使用 AI 助手和邮件管理功能

### 日常使用流程
1. **登录系统** → 用户身份验证
2. **查看邮件** → 浏览邮件列表和内容
3. **AI 助手** → 使用 AI 生成回复
4. **发送邮件** → 发送回复或新邮件
5. **邮件管理** → 标记、删除、整理邮件

---

## 🔒 **安全考虑**

### 数据安全
- **凭据保护**: 邮件密码不存储，仅用于连接验证
- **传输加密**: 所有邮件通信使用 SSL/TLS
- **会话安全**: HTTP-only Cookie，JWT 定期过期

### 权限控制
- **路由保护**: 中间件验证用户登录状态
- **操作验证**: 每个操作验证用户权限
- **团队隔离**: 严格的团队数据隔离

---

## 📊 **性能特点**

### 邮件处理
- **按需连接**: 避免长连接资源占用
- **本地缓存**: IndexedDB 缓存减少重复请求
- **增量同步**: 只同步新邮件，提升效率

### 用户体验
- **响应速度**: 本地缓存实现秒级邮件加载
- **无限滚动**: 优化大量邮件展示性能
- **实时反馈**: 操作状态实时更新

---

## 🚀 **部署和运维**

### 环境配置
- **生产环境**: Vercel 部署，PostgreSQL 数据库
- **环境变量**: Azure OpenAI、Stripe、数据库等配置
- **监控**: 错误追踪和性能监控

### 扩展性
- **水平扩展**: 无状态设计支持多实例部署
- **数据库优化**: 适当索引和查询优化
- **CDN 加速**: 静态资源 CDN 分发

---

## 📈 **产品指标**

### 功能指标
- **邮件同步成功率**: > 99%
- **AI 回复生成成功率**: > 95%
- **系统响应时间**: < 2秒
- **邮件发送成功率**: > 98%

### 用户体验指标
- **登录成功率**: > 99%
- **页面加载时间**: < 3秒
- **操作错误率**: < 1%

---

## 🔄 **已知限制和改进方向**

### 当前限制
1. **邮件协议**: 依赖 IMAP/SMTP，不支持 Exchange Web Services
2. **离线功能**: 需要网络连接，无离线模式
3. **附件处理**: 基础附件显示，不支持在线预览
4. **搜索功能**: 基础邮件列表，无全文搜索

### 改进方向
1. **协议扩展**: 支持更多邮件协议
2. **离线缓存**: 增加离线邮件访问
3. **附件预览**: 在线文档预览功能
4. **搜索优化**: 全文搜索和高级筛选
5. **移动端**: 响应式设计优化

---

## 📝 **总结**

EmAilX 作为智能邮件管理平台，成功实现了：
- **完整的邮件客户端功能**（接收、发送、管理）
- **智能 AI 助手功能**（回复生成、多语言、多风格）
- **企业级功能**（团队协作、权限管理、订阅付费）
- **现代化技术栈**（Next.js、TypeScript、AI 集成）

产品具备投入商业使用的基础功能，技术架构稳定，用户体验良好，是一个功能完整的 SaaS 产品。
